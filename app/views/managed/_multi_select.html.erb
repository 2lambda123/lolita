<% unless @multi_input_includes %>
  <link href="/lolita/stylesheets/multiedit.css" type="text/css" rel="stylesheet" />
  <script src="/lolita/javascripts/multiedit.js" type="text/javascript"></script>
  <% @multi_input_includes=true %>
<% end %>
<div class="multiedit">
  <% if hsh[:maximum]  %>
    <!-- non-li element with class="max" which can be val()d to set maximum item count -->
    <input type="hidden" class="max" value="<%=hsh[:maximum]%>" />
  <% end %>
  <% hsh[:limit].each{|class_name,limit| %>
    <input type="hidden" class="limit" title="<%=class_name%>" value="<%=limit%>" />
  <% } if hsh[:limit] %>
  <!-- so that if existing part is/becomes empty, an empty array is passed to update -->
  <input type="hidden" name="<%=hsh[:object]%>[<%=hsh[:attribute]%>][]" value="" />
  <ol>
    <!-- template for future li's -->
    <li class="template">
      <% if hsh[:template] %>
        <%=hsh[:template] %>
      <% else %>
        {text} <span class="toggle"><img src="/lolita/images/icons/trash.gif" alt="trash" /></span>
        <!-- reflects the option, so it can be put back to the select on "trashing" and
        contains value to pass to update -->
        <input type="hidden"
               class="mirror"
               title="{text}"
               name="{attr}[]"
               value="{value}" />

      <% end %>
    </li>
    <!-- output existing items mirroring the structure above -->
    <% hsh[:existing].each{|option|   %>
      <li <%="class=\"#{option[2]}\"" if option[2] %>>
        <%=option[0] %>
        <span class="toggle">
          <img src="/lolita/images/icons/trash.gif" alt="trash" />
        </span>
        <input type="hidden"
               class="mirror"
               name="<%=hsh[:object]%>[<%=hsh[:attribute]%>][]"
               title="<%=option[0]%>"
               value="<%=option[1]%>" />
      </li>
    <% } if hsh[:existing] %>

    <li class="control">
      <select>
        <% hsh[:suggest].each {|option| %>
          <option<%=' class="'+option[2]+'"' if option[2] %>
            value="<%=option[1]%>"><%=option[0]%></option>

        <% } if hsh[:suggest] %>
      </select>
      <img onclick="multi_attr_stack(this,'<%=hsh[:object]%>[<%=hsh[:attribute]%>]')"
           src="/lolita/images/icons/add.png" alt="+" />
    </li>
  </ol>
</div> <!-- multiselect out -->